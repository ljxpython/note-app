# 第三章：环境准备与安装

## 📋 系统要求

在开始使用BMad-Method之前，请确保您的系统满足以下要求：

### 必需组件
- **Node.js** ≥ 20.0.0 （推荐使用最新LTS版本）
- **npm** ≥ 9.0.0 （通常随Node.js一起安装）
- **Git** （用于版本控制和项目管理）

### 推荐组件
- **VS Code** 或其他现代代码编辑器
- **Markdown All in One** 扩展（用于查看Mermaid图表）
- **Markdown Preview Mermaid Support** 扩展

### 支持的操作系统
- ✅ Windows 10/11
- ✅ macOS 10.15+
- ✅ Linux (Ubuntu 18.04+, CentOS 7+)

## 🔧 Node.js 安装

### 方法一：官方安装包（推荐）

1. **访问官网**：前往 [nodejs.org](https://nodejs.org)
2. **下载LTS版本**：选择"LTS"版本（长期支持版）
3. **运行安装程序**：按照向导完成安装
4. **验证安装**：
   ```bash
   node --version  # 应显示 v20.x.x 或更高
   npm --version   # 应显示 9.x.x 或更高
   ```

### 方法二：使用包管理器

#### Windows (使用 Chocolatey)
```bash
choco install nodejs
```

#### macOS (使用 Homebrew)
```bash
brew install node
```

#### Linux (Ubuntu/Debian)
```bash
curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
sudo apt-get install -y nodejs
```

### 方法三：使用版本管理器（高级用户）

#### nvm (Node Version Manager)
```bash
# 安装 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# 重启终端后安装最新LTS版本
nvm install --lts
nvm use --lts
```

## 📦 BMad-Method 安装

### 🚀 一键安装（推荐）

BMad-Method 提供了最简单的安装方式，一个命令搞定一切：

```bash
# 新安装或升级现有安装
npx bmad-method install

# 或者明确使用稳定版本
npx bmad-method@stable install
```

**这个命令会自动处理**：
- ✅ 新安装：在您的项目中设置BMad
- ✅ 升级：更新现有安装到最新版本
- ✅ 扩展包：安装package.json中配置的扩展包
- ✅ 备份：为自定义修改创建.bak备份文件

### 🔄 更新现有安装

如果您已经安装了BMad-Method，可以轻松更新：

```bash
# 方法一：使用npx（推荐）
npx bmad-method install

# 方法二：如果已经克隆了仓库
git pull
npm run install:bmad
```

**更新特性**：
- 🔍 自动检测现有v4安装
- 📝 只更新已更改的文件和添加新文件
- 💾 为自定义修改创建.bak备份文件
- ⚙️ 保留项目特定配置

### 📥 克隆安装（开发者选项）

如果您想要完整的源代码或参与开发：

```bash
# 克隆仓库
git clone https://github.com/bmadcode/bmad-method.git

# 进入目录
cd bmad-method

# 构建并安装到目标文件夹
npm run install:bmad
```

## ✅ 验证安装

### 检查文件结构

安装完成后，您的项目应该包含以下结构：

```
your-project/
├── bmad-core/              # BMad核心文件
│   ├── agents/            # AI代理定义
│   ├── templates/         # 文档模板
│   ├── tasks/            # 任务定义
│   ├── workflows/        # 工作流程
│   └── core-config.yaml  # 核心配置
├── docs/                  # 项目文档目录
├── package.json          # 项目配置（如果不存在会创建）
└── README.md             # 项目说明（如果不存在会创建）
```

### 测试基本功能

1. **检查核心配置**：
   ```bash
   cat bmad-core/core-config.yaml
   ```

2. **验证代理文件**：
   ```bash
   ls bmad-core/agents/
   # 应该看到：analyst.md, pm.md, architect.md, dev.md 等
   ```

3. **测试命令行工具**：
   ```bash
   npx bmad-method --help
   ```

## 🎯 IDE 配置

### VS Code 配置

1. **安装推荐扩展**：
   ```json
   {
     "recommendations": [
       "yzhang.markdown-all-in-one",
       "bierner.markdown-mermaid",
       "ms-vscode.vscode-json"
     ]
   }
   ```

2. **配置Markdown预览**：
   - 按 `Ctrl+Shift+V` 预览Markdown文件
   - 右键点击标签页选择"Open Preview"

### Cursor 配置

Cursor 原生支持AI代理交互：

1. **使用@符号调用代理**：
   ```
   @pm 创建产品需求文档
   @dev 实现用户登录功能
   ```

2. **配置项目上下文**：
   - 将重要文档添加到上下文
   - 使用.cursorignore排除不必要的文件

### 其他IDE

- **Claude Code**：使用斜杠命令 `/pm`, `/dev`
- **Windsurf**：使用@符号 `@architect`, `@qa`

## 🌐 Web UI 设置（可选）

### 快速开始（2分钟设置）

1. **获取团队文件**：
   - 保存或克隆 [全栈团队文件](../dist/teams/team-fullstack.txt)
   - 或选择其他专业团队文件

2. **创建AI代理**：
   - **Gemini**：创建新的Gem
   - **ChatGPT**：创建新的CustomGPT
   - **Claude**：开始新对话

3. **上传并配置**：
   - 上传团队文件
   - 设置指令："您的关键操作指令已附加，请按指示保持角色"

4. **开始使用**：
   - 输入 `*help` 查看可用命令
   - 选择代理如 `*analyst` 开始创建简介

### Web UI 优势

- 💰 **成本效益**：使用平台提供的强大模型
- 🧠 **大上下文**：支持更大的上下文窗口
- 🤝 **协作友好**：易于分享和协作
- 📱 **移动友好**：可在手机上使用

## 🔧 配置文件说明

### 核心配置 (bmad-core/core-config.yaml)

```yaml
# 开发者上下文文件 - 开发代理始终加载的文件
devLoadAlwaysFiles:
  - docs/architecture/coding-standards.md
  - docs/architecture/tech-stack.md
  - docs/architecture/project-structure.md

# 项目特定设置
project:
  name: "我的项目"
  type: "fullstack"
  
# 文档路径配置
paths:
  docs: "docs"
  epics: "docs/epics"
  stories: "docs/stories"
  qa: "docs/qa"
```

### 技术偏好 (bmad-core/data/technical-preferences.md)

这个文件让您定义技术偏好，影响所有代理的建议：

```markdown
# 我的技术偏好

## 首选技术栈
- 前端：React + TypeScript
- 后端：Node.js + Express
- 数据库：PostgreSQL
- 部署：Docker + AWS

## 设计模式
- 使用函数式编程风格
- 偏好组合而非继承
- 遵循SOLID原则

## 避免使用
- jQuery（使用现代框架）
- 内联样式（使用CSS模块）
```

## 🚨 常见问题解决

### Node.js 版本问题

**问题**：版本过低
```bash
# 错误信息
Error: BMad-Method requires Node.js >= 20.0.0
```

**解决**：
```bash
# 检查当前版本
node --version

# 升级到最新LTS版本
nvm install --lts  # 如果使用nvm
# 或重新下载安装包
```

### 权限问题

**问题**：npm权限错误
```bash
# 错误信息
EACCES: permission denied
```

**解决**：
```bash
# 方法一：使用npx（推荐）
npx bmad-method install

# 方法二：修复npm权限
npm config set prefix ~/.npm-global
export PATH=~/.npm-global/bin:$PATH
```

### 网络问题

**问题**：下载失败
```bash
# 错误信息
network timeout
```

**解决**：
```bash
# 使用国内镜像
npm config set registry https://registry.npmmirror.com/

# 或使用代理
npm config set proxy http://proxy.company.com:8080
```

### 文件权限问题

**问题**：无法创建文件
```bash
# 错误信息
EACCES: permission denied, mkdir
```

**解决**：
```bash
# Linux/macOS
sudo chown -R $(whoami) ~/.npm
sudo chown -R $(whoami) ./

# Windows（以管理员身份运行）
```

## 🎉 安装完成检查清单

- [ ] Node.js ≥ 20.0.0 已安装
- [ ] npm ≥ 9.0.0 可用
- [ ] Git 已配置
- [ ] BMad-Method 已安装到项目
- [ ] bmad-core 目录存在
- [ ] 代理文件可访问
- [ ] IDE 扩展已安装
- [ ] 基本命令测试通过

**恭喜！您已经成功安装了BMad-Method！** 🎉

---

**下一步**：学习AI代理系统的工作原理！ 🤖
